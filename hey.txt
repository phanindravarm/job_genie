def upload_file():
    if 'file' not in request.files:
        return 'No file part', 400
    
    file = request.files['file']
    
    if file.filename == '':
        return 'No selected file', 400
    file_path = os.path.join(UPLOAD_FOLDER, file.filename)

    file.save(file_path)
    try:
        uploaded_file = client.files.create(
            file=open(file_path, "rb"),
            purpose="user_data"
        )

        response = client.responses.create(
            model="gpt-4o-mini",
            input=[
                {
                    "role": "user",
                    "content": [
                        {
                            "type": "input_file",
                            "file_id": uploaded_file.id,
                        },
                        {
                            "type": "input_text",
                            "text": prompt,
                        },
                    ]
                }
            ]
        )
        client.files.delete(uploaded_file.id)
        os.remove(file_path)

        return jsonify({'analysis': response.output_text}), 200

    except Exception as e:
        return jsonify({'error': str(e)}), 500
